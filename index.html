<html>

<head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js">
  </script>
</head>

<body>
  <canvas id="canvas" style=""></canvas>
  <script>

    var init_size = true;
    window.addEventListener('resize', resizeCanvas, false);
    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      if (init_size) {
        init_size = false;
        return;
      }
      for (var i = 0; i < agents.length; i++) {
        agents[i].canvas_resize();
      }
    }

    // resizeCanvas();

    var context = canvas.getContext('2d');
    var img;
    var bkImg = null;
    //current position
    var x = 10;
    var y = 10;
    //next position
    var x_dest = 0;
    var y_dest = 0;
    // img.src = "imgs/0.png"
    var lastAnimationTime = new Date().getTime();
    var timeDelta = 35;  //changes animation speed, higher = slower
    var dataReady = false;
    var animationLoop = [];
    var loopI = 0;
    var direction;
    var status = "idle";

    function draw() {

      window.requestAnimationFrame(draw);
      //console.log("Drawing");

      if (dataReady == false) {
        //console.log("Loading..");
        return;
      }

      if (timeDelta + lastAnimationTime > new Date().getTime()) {
         //console.log("timedelta return");
         return;
      }
      lastAnimationTime = new Date().getTime();
      if (bkImg != null) {
        context.putImageData(bkImg, x, y);
      }

      //leftclick equals move
      $(document).on("mousedown", function () {
        status = "moving";
        //get coordinates of mouse
        x_dest = event.pageX;
        y_dest = event.pageY;
        console.log(x_dest);
        console.log(y_dest);
      });



      var img = new Image();
      img.src = "imgs/Idle (0).png";

      //console.log("draw image test b4 hit");
      //this.context.drawImage(img, this.curX, this.curY, this.imgWidth, this.imgHeight)

      tempx = x;
      tempy = y;
      xdiff = Math.abs(tempx - x_dest);
      ydiff = Math.abs(tempy - y_dest);

      //repainting canvas
      bkImg = context.getImageData(x, y, 134, 142);

      //idle
      if (x_dest == tempx && y_dest == tempy) {
        // play idle animation
        animationLoop = [spriteImgs['(Idle)']['Idle0'], spriteImgs['(Idle)']['Idle1'], spriteImgs['(Idle)']['Idle2'], spriteImgs['(Idle)']['Idle3'], spriteImgs['(Idle)']['Idle4'], spriteImgs['(Idle)']['Idle5'], spriteImgs['(Idle)']['Idle6'], spriteImgs['(Idle)']['Idle7'], spriteImgs['(Idle)']['Idle8'], spriteImgs['(Idle)']['Idle9'], spriteImgs['(Idle)']['Idle10'], spriteImgs['(Idle)']['Idle11'], spriteImgs['(Idle)']['Idle12'], spriteImgs['(Idle)']['Idle13'], spriteImgs['(Idle)']['Idle14'], spriteImgs['(Idle)']['Idle15'], spriteImgs['(Idle)']['Idle16'], spriteImgs['(Idle)']['Idle17'], spriteImgs['(Idle)']['Idle18'], spriteImgs['(Idle)']['Idle19'], spriteImgs['(Idle)']['Idle20'], spriteImgs['(Idle)']['Idle21']]
        //Thought I'd give it a shot lol
        //I'll try again after I've recharged :)
      }

      //movement
      if (x_dest < tempx && y_dest < tempy) {
        direction = "(NorthWest)";
        animationLoop = [spriteImgs[direction]['walk1'], spriteImgs[direction]['walk2'], spriteImgs[direction]['walk3'], spriteImgs[direction]['walk4']];
      }
      if (x_dest < tempx && y_dest > tempy) {
        direction = "(SouthWest)";
        animationLoop = [spriteImgs[direction]['walk1'], spriteImgs[direction]['walk2'], spriteImgs[direction]['walk3'], spriteImgs[direction]['walk4']];
      }
      if (x_dest > tempx && y_dest < tempy) {
        direction = "(NorthEast)";
        animationLoop = [spriteImgs[direction]['walk1'], spriteImgs[direction]['walk2'], spriteImgs[direction]['walk3'], spriteImgs[direction]['walk4']];
      }
      if (x_dest > tempx && y_dest > tempy) {
        direction = "(SouthEast)";
        animationLoop = [spriteImgs[direction]['walk1'], spriteImgs[direction]['walk2'], spriteImgs[direction]['walk3'], spriteImgs[direction]['walk4']];
      }
      if (x_dest < tempx && y_dest == tempy) {
        direction = "(West)";
        animationLoop = [spriteImgs[direction]['walk1'], spriteImgs[direction]['walk2'], spriteImgs[direction]['walk3'], spriteImgs[direction]['walk4']];
      }
      if (x_dest > tempx && y_dest == tempy) {
        direction = "(East)";
        animationLoop = [spriteImgs[direction]['walk1'], spriteImgs[direction]['walk2'], spriteImgs[direction]['walk3'], spriteImgs[direction]['walk4']];
      }
      if (x_dest == tempx && y_dest < tempy) {
        direction = "(North)";
        animationLoop = [spriteImgs[direction]['walk1'], spriteImgs[direction]['walk2'], spriteImgs[direction]['walk3'], spriteImgs[direction]['walk4']];
      }
      if (x_dest == tempx && y_dest > tempy) {
        direction = "(South)";
        animationLoop = [spriteImgs[direction]['walk1'], spriteImgs[direction]['walk2'], spriteImgs[direction]['walk3'], spriteImgs[direction]['walk4']];
        animation_x = xdiff;
        animation_y = ydiff + tempy;
      }

      // loopI++;
      // if (loopI > 3) {
      //   loopI = 0;
      // }

      img.src = animationLoop[loopI];
      //console.log(animationLoop[loopI]);

      x = tempx;
      y = tempy;
      while(xdiff + ydiff > 0){
        loopI++;
        if (loopI > 3) {
          loopI = 0;
        }
        if(xdiff != 0 && tempx > x_dest){
          x--;
          xdiff--;
        }
        if(xdiff !=0 && tempx < x_dest){
          x++;
          xdiff--;
        }
        if(ydiff != 0 && tempy > y_dest){
          y--;
          ydiff--;
        }
        if(ydiff != 0 && tempy < y_dest){
          y++;
          ydiff--;
        }
        //console.log("distance is now");
        //console.log(xdiff);
        //console.log(ydiff);
        img.src = animationLoop[loopI];
        console.log("hit");
                context.drawImage(img, x, y, 134, 142);
                break;
      }
    context.drawImage(img, x, y, 134, 142);
    status = "idle";
    }

    $(document).ready(function () {

      resizeCanvas();
      $.getJSON("spriteImgs.JSON", function (data) {
        console.log("Loaded");
        alert("Loaded");
        dataReady = true;
        spriteImgs = data;
        console.log(spriteImgs);
      });



      draw();


    });

  </script>
</body>

</html>
